<template>
<div class="page" data-name="bookingdetails">
    <div class="navbar pgradback navborder" >
     <div class="navbar-inner sliding">
        <div class="left">
          <a href="#" class="link back">
            <i class="ion ion-ios-arrow-back"></i>
            <span class="ios-only">Back</span>
          </a>
        </div>
        <div class="title sliding titlehd whitecolor">Booking Details</div>
		
      </div>
    </div>
		
		 
  <!-- Top Navbar -->

  <div class="toolbar tabbar-labels toolbar-bottom-md customtoolbar">
    <div class="toolbar-inner">
      <a href="/pmainhome/" class="tab-link">
			<i class="ion ion-ios-pulse icontab"></i>
            <span class="tabbar-label badgefont">Explore</span>
	  </a>
      <a href="#tab-2" class="tab-link tab-link-active activeborder">
			<i class="ion ion-ios-medkit" style="font-size:x-large;"></i>
            <span class="tabbar-label badgefont">Booking</span>
	  </a>
	  <a href="/pupayment/" class="tab-link">
			<i class="ion ion-ios-card icontab"></i>
            <span class="tabbar-label badgefont">Wallet</span>
	  </a>
      <a href="/paccount/" class="tab-link">
			<i class="ion ion-ios-switch icontab"></i>
            <span class="tabbar-label badgefont">Account</span>
	  </a>
    </div>
  </div>
  <div class="tabs">
    <div id="tab-1" class="page-content tab ">
   
          
    </div>
    <div id="tab-2" class="page-content tab tab-active bodybg">
		
		
        <div class="block">
		
		
		
	   <span id="lclpsrvDetData">
  
		<div style="height:150px !important"><center><p><img src="./img/imgspinner.gif" width="100px" height="100px"></p></center></div>
		
		</span> 
		
		<span id="lclsrvAction" style="display:none">
		<b>Please respond to awaiting request:</b>
			<p class="row">
					<button class="col button button-big button-raised greencolor" @click="servAccept"><i class="ion ion-ios-checkmark greencolor" style="font-size:larger"></i> Accept</button>
					<button class="col button button-big button-raised sheet-open" data-sheet=".reject-sheet"><i class="ion ion-ios-close" style="font-size:larger" ></i> Reject</button>
			</p>	
		</span>
	    
		<!--
		<p class="row">
					<button class="col button button-big button-raised greencolor sheet-open" data-sheet=".reject-sheet"><i class="ion ion-ios-checkmark greencolor" style="font-size:larger"></i> Accept</button>
					<button class="col button button-big button-raised"  @click="createSheet"><i class="ion ion-ios-close" style="font-size:larger" ></i> Reject</button>
			</p>
		-->
    </div>
	
	
<div class="sheet-modal reject-sheet">
      <div class="toolbar" style="background:#fff;border-bottom:1px solid #ebebeb">
        <div class="toolbar-inner" style="color:#3e3e3e">
          <div class="left" style="margin-left:5px">Enter Reject Reason:</div>
          <div class="right">
            <a class="link sheet-close">X</a>
          </div>
        </div>
      </div>
      <div class="sheet-modal-inner">
        <div class="page-content">
          <div class="block">
           <div class="list no-hairlines-md">
			<ul>			  
				<li class="item-content item-input">
				  <div class="item-inner">
					<div class="item-title item-label"></div>
					<div class="item-input-wrap">
					  <textarea placeholder="Enter Text..." class="textareamod" id="resReject"></textarea>
					</div>
				  </div>
				</li>
			  
			 </ul>
			</div>
			
			<p class="row">
			<button class="col button button-fill color-blue" @click="servReject">Submit</button>
		  </p>
		  
		  
          </div>
        </div>
      </div>
	  
    </div> 
	</div>
    <div id="tab-3" class="page-content tab">
      <div class="block">
        <p>Tab 3 content</p>
       
      </div>
    </div>
	

	
  
</div>

 

</div>

	
</template>
<style>
.divspinner
{background:transparent url('./img/imgspinner.gif') center no-repeat;}
.md .navbar:after
{height:0px;}
.md .color-theme-red .toolbar:not(.messagebar), .md .color-theme-red.toolbar:not(.messagebar)
{background: #ffffff;}
.md .tabbar a.tab-link.active-state, .md .tabbar a.tab-link.tab-link-active, .md .tabbar-labels a.tab-link.active-state, .md .tabbar-labels a.tab-link.tab-link-active
{color: #346d9a;}
.md .item-input-wrap:after
{background-color:#e3e1e1;}
.md .toolbar a
{color: #f44336;}
.md .color-theme-red .input-after:after, .md .color-theme-red .item-input-focused .item-input-wrap:after
{background: #e3e1e1;}
.md .list
{margin: 10px 0;}
.iptborder
{background:#e3e1e1;border-radius:10px;}
.boxcol
{border-radius: 10px;background: #ffffff none repeat scroll 0 0;box-shadow: 0 5px 20px 0 rgba(0,0,0,0.15);margin:15px 0;}
.boxcol2
{border-radius: 0px;background: #ffffff none repeat scroll 0 0;box-shadow: 0 5px 20px 0 rgba(0,0,0,0.15);margin:15px 0;}
.alnright
{float: right;}
.customli2
{border-bottom: 1px solid #e0e0e0;font-size:16px !important;}
.md .list ul:before
{display:none;visibility:hidden;}
.listline
{border-bottom: 1px solid #c7c7c7;}
</style>

<script>
  return {
    data: function () {
      return {		
		//read data from root object
		//appdata: this.$app.data.appdata,
		//appconst: this.$app.data.appconst,
       // srvCategory: this.$app.data.srvCategory,
        //srvCatOthers: this.$app.data.srvCatOthers,
      };
    },
	methods: {
	servAccept: function () {
	 var self = app;
		  // Close opened sheets on page out
		  app.sheet.close();
		  
		
		
		var userPhone = localStorage.getItem("lcluserPhone");
		var serviceSno = localStorage.getItem("lclserviceSno");
		var url = app.data.appconst.url;
		var constr = app.data.appconst.constr;
		
		
		document.getElementById("lclsrvAction").innerHTML  = '<div style="height:100px !important"><center><p><img src="./img/imgspinner.gif" width="100px" height="100px"></p></center></div>';
		
		 //Call server and send code
		app.request({
				url: url+'Srvaccept/',
				dataType:'json',
				method: 'GET',
				data:{
				authid: constr,
				serviceSno:serviceSno,
				userPhone:userPhone
				},
				crossDomain:true,
				success:function(adata){
				 
				 
				 if(adata.status == "Success")
					{
						
						//console.log(adata);
						document.getElementById("lclsrvAction").style.display = "none";
						document.getElementById("lclpsrvDetData").innerHTML = adata.serviceData;
						
						localStorage.setItem("lclpsrvData", adata.lclpsrvData);
						
						
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						app.toastBottom.open();
					
					}
					else
					{
						//app.dialog.alert(adata.message);
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						//app.toastBottom.open();
					}
					  
				},
				error:function(error){
				//console.log(error.code);
				console.log(error);
					//if(!navigator.onLine) { }
						app.toastBottom =  app.toast.create({
							text: 'An Error Occurred, Please check connection!',
							closeTimeout: 3000,
						  })
						// Open it
						app.toastBottom.open();
						
				
				},
				complete:function(){
					//setTimeout(function () {app.dialog.close();}, 1000);
				}
			});
	
	
	},
	servReject: function () {
	 var self = app;
		  // Close opened sheets on page out
		  app.sheet.close();
		  
		
		
		var userPhone = localStorage.getItem("lcluserPhone");
		var serviceSno = localStorage.getItem("lclserviceSno");
		var url = app.data.appconst.url;
		var constr = app.data.appconst.constr;
		var resReject = $$('#resReject').val();
		
		//Check that reject is not emtpy
		if (!resReject){
		  app.dialog.alert('Please provide a reject reason.');
		  return;
		 }
		
		document.getElementById("lclsrvAction").innerHTML  = '<div style="height:100px !important"><center><p><img src="./img/imgspinner.gif" width="100px" height="100px"></p></center></div>';
		
		 //Call server and send code
		app.request({
				url: url+'Srvreject/',
				dataType:'json',
				method: 'GET',
				data:{
				authid: constr,
				serviceSno:serviceSno,
				resReject:resReject,
				userPhone:userPhone
				},
				crossDomain:true,
				success:function(adata){
				 
				 
				 if(adata.status == "Success")
					{
						
						//console.log(adata);
						document.getElementById("lclsrvAction").style.display = "none";
						document.getElementById("lclpsrvDetData").innerHTML = adata.serviceData;
						
						localStorage.setItem("lclpsrvData", adata.lclpsrvData);
						
						
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						app.toastBottom.open();
					
					}
					else
					{
						//app.dialog.alert(adata.message);
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						//app.toastBottom.open();
					}
					  
				},
				error:function(error){
				//console.log(error.code);
				console.log(error);
					//if(!navigator.onLine) { }
						app.toastBottom =  app.toast.create({
							text: 'An Error Occurred, Please check connection!',
							closeTimeout: 3000,
						  })
						// Open it
						app.toastBottom.open();
						
				
				},
				complete:function(){
					//setTimeout(function () {app.dialog.close();}, 1000);
				}
			});
	
	
	},
    createSheet: function () {
      var self = this;
      // Create sheet modal
      if (!self.sheet) {
        self.sheet = self.$app.sheet.create({
          content: '\
            <div class="sheet-modal">\
              <div class="toolbar">\
                <div class="toolbar-inner justify-content-flex-end">\
                  <a href="#" class="link sheet-close">Close</a>\
                </div>\
              </div>\
              <div class="sheet-modal-inner">\
                <div class="page-content">\
                  <div class="block">\
                  <div class="list no-hairlines-md">\
				   <ul>\
                    <li class="item-content item-input">\
					   <div class="item-inner">\
					   <div class="item-title item-label"></div>\
					   <div class="item-input-wrap">\
					   <textarea placeholder="Enter Reject Reason..." class="textareamod" id="resReject"></textarea>\
					   </div>\
					   </div>\
					   </li>\
					   </ul>\
					   </div>\
					   <p class="row">\
					<button class="col button button-fill color-blue" @click="servReject">Submit</button>\
					</p>\
                  </div>\
                </div>\
              </div>\
            </div>\
          '
        });
      }
      // Close inline sheet
	 /* <div class="list no-hairlines-md">\
			<ul>\  
				<li class="item-content item-input">\
				  <div class="item-inner">\
					<div class="item-title item-label"></div>\
					<div class="item-input-wrap">\
					  <textarea placeholder="Enter Text..." class="textareamod" id="resReject"></textarea>\
					</div>\
				  </div>\
				</li>\
			 </ul>\
			</div>\
			
			<p class="row">
			<button class="col button button-raised color-blue">Submit</button>
		  </p>
		  */
      if (self.$('.demo-sheet.modal-in').length > 0) self.$app.sheet.close('.demo-sheet');
      // Open it
      self.sheet.open();
    },
  },
	on: {
      pageInit: function (e, page) {
		//var lclalertNum = localStorage.getItem("lclalertNum");
		//document.getElementById("lclalertNum").innerHTML = lclalertNum;
		
		//this.$app.methods.getNoticeprvd();
		//var lclalertNum = localStorage.getItem("lclalertNum");
		//document.getElementById("lclalertNumsrvdet").innerHTML = lclalertNum;

      },
	   pageAfterIn: function(e, page) {
	   
	   //get constant and serviceSno
	    var url = app.data.appconst.url;
		var constr = app.data.appconst.constr;
		var userPhone = localStorage.getItem("lcluserPhone");
		var serviceSno = page.route.query.serviceSno;
		
		//Set local storage serviceSno
	    localStorage.setItem("lclserviceSno", serviceSno);
	   //call API
	   // Show Preloader
		//app.dialog.progress();
		
		 //Call server and send code
		app.request({
				url: url+'Srvdetails/',
				dataType:'json',
				method: 'GET',
				data:{
				authid: constr,
				serviceSno:serviceSno,
				userPhone:userPhone
				},
				crossDomain:true,
				success:function(adata){
				 
				 
				 if(adata.status == "Success")
					{
						
						
						
						console.log(adata);
						
						if(adata.serviceData){
							document.getElementById("lclpsrvDetData").innerHTML = adata.serviceData;
							
							if(adata.prvAction == "True")
							{document.getElementById("lclsrvAction").style.display = "block";}
						}
						else
						{
						var norecord = '<img src="img/no_record_found.png" style="width:100%;margin-top:40%">';
						setTimeout(function () {document.getElementById("lclpsrvDetData").innerHTML = norecord;}, 1000);
						}
						
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						//app.toastBottom.open();
					
					}
					else
					{
						//app.dialog.alert(adata.message);
						app.toastBottom =  app.toast.create({
							text: adata.message,
							closeTimeout: 3000,
						  })
						// Open it
						//app.toastBottom.open();
					}
					  
				},
				error:function(error){
				//console.log(error.code);
				console.log(error);
					//if(!navigator.onLine) { }
						app.toastBottom =  app.toast.create({
							text: 'An Error Occurred, Please check connection!',
							closeTimeout: 3000,
						  })
						// Open it
						app.toastBottom.open();
						
				
				},
				complete:function(){
					//setTimeout(function () {app.dialog.close();}, 1000);
				}
			});
	   
	    
		
		
		
		
		
	   
	   //display result
	   },
	   pageBeforeOut: function () {
		  var self = this;
		  // Close opened sheets on page out
		  self.$app.sheet.close();
		},
		pageBeforeRemove: function () {
		  var self = this;
		  // Destroy sheet modal when page removed
		  if (self.sheet) self.sheet.destroy();
		},
    },
  };
</script>